<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Flutter Travis CI 脚本相关问题 | YU-NO</title>
<meta name="description" content="岁月总是历久弥新，需要细细品尝。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://microtears.github.io/favicon.ico?v=1564768251322">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://microtears.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144016944-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144016944-1');
</script>


  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://microtears.github.io">
        <img src="https://microtears.github.io/images/avatar.png?v=1564768251322" class="site-logo">
        <h1 class="site-title">YU-NO</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/microtears" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      岁月总是历久弥新，需要细细品尝。
    </div>
    <div class="site-footer">
      <span id="timeX"></span>
<span class="my-face">❤</span>
<script type="text/javascript">
    function updateTime() {
        var date1 = '2019/07/17 00:00:00';
        var date2 = new Date();
        var date3 = date2.getTime() - new Date(date1).getTime();
        var days = Math.floor(date3 / (24 * 3600 * 1000));
        var leave1 = date3 % (24 * 3600 * 1000);
        var hours = Math.floor(leave1 / (3600 * 1000));
        var leave2 = leave1 % (3600 * 1000);
        var minutes = Math.floor(leave2 / (60 * 1000));
        var leave3 = leave2 % (60 * 1000);
        var seconds = Math.round(leave3 / 1000);
        var timeX = document.getElementById('timeX');
        timeX.innerHTML = "已运行" + days + "天" + hours + "小时" + minutes + "分钟" + seconds + "秒";
    }
    setInterval(updateTime, 1000);
</script>
<br/>
<br/>    
Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://microtears.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Flutter Travis CI 脚本相关问题</h2>
            <div class="post-date">2019-07-26</div>
            
            <div class="post-content">
              <h2 id="q1">Q1</h2>
<h2 id="报错信息">报错信息</h2>
<pre><code class="language-shell">$ openssl aes-256-cbc -K $encrypted_d2e7c15ed967_key -iv $encrypted_d2e7c15ed967_iv -in mood.jks.enc -out mood.jks -d
bad decrypt
140442486961824:error:0606506D:digital envelope routines:EVP_DecryptFinal_ex:wrong final block length:evp_enc.c:532:
The command &quot;openssl aes-256-cbc -K $encrypted_d2e7c15ed967_key -iv $encrypted_d2e7c15ed967_iv -in mood.jks.enc -out mood.jks -d&quot; failed and exited with 1 during.
Your build has been stopped.
</code></pre>
<h2 id="错误原因">错误原因</h2>
<blockquote>
<p>Caveat</p>
<p>There is a report of this function not working on a local Windows machine. Please use a Linux or OS X machine.</p>
</blockquote>
<h2 id="解决办法">解决办法</h2>
<p>在linux或mac os下运行<code>travis encrypt-file mood.jks --add</code>命令。</p>
<h2 id="q2">Q2</h2>
<h2 id="报错信息-2">报错信息</h2>
<pre><code class="language-shell">Please make sure you have the correct access rights
and the repository exists.
fatal: clone of 'git@github.com:microtears/asset_generator.git' into submodule path '/home/travis/build/microtears/Mood/asset_generator' failed
Failed to clone 'asset_generator'. Retry scheduled
Cloning into '/home/travis/build/microtears/Mood/asset_generator'...
Permission denied (publickey).
fatal: Could not read from remote repository.
Please make sure you have the correct access rights
and the repository exists.
fatal: clone of 'git@github.com:microtears/asset_generator.git' into submodule path '/home/travis/build/microtears/Mood/asset_generator' failed
Failed to clone 'asset_generator' a second time, aborting
The command &quot;eval git submodule update --init --recursive &quot; failed. 
</code></pre>
<h2 id="错误原因-2">错误原因</h2>
<p>使用git协议的地址时候，自动使用了publickey进行了验证，由于该publickey并没有添加到github账户上，所以Permission denied (publickey).</p>
<h2 id="解决办法-2">解决办法</h2>
<p>如果项目中有submodule，则将其中所有使用git协议的url切换到https协议</p>
<h2 id="q3">Q3</h2>
<h2 id="报错信息-3">报错信息</h2>
<pre><code class="language-shell">No file or variants found for asset: assets/flare.
[   +1 ms] Error building assets
</code></pre>
<h2 id="错误原因-3">错误原因</h2>
<p>pubspec.yaml assets路径填写错误或者该路径下文件不存在。</p>
<h2 id="解决办法-3">解决办法</h2>
<p>将路径修改为正确的路径，清除那些实际不存在文件的路径。</p>
<h2 id="q4">Q4</h2>
<h2 id="报错信息-4">报错信息</h2>
<pre><code class="language-shell">&gt; Configure project :app
File /home/travis/.android/repositories.cfg could not be loaded.
Checking the license for package Android SDK Build-Tools 28.0.3 in /usr/local/android-sdk/licenses
Warning: License for package Android SDK Build-Tools 28.0.3 not accepted.
Checking the license for package Android SDK Platform 28 in /usr/local/android-sdk/licenses
Warning: License for package Android SDK Platform 28 not accepted.


FAILURE: Build failed with an exception.

* Where:
Build file '/home/travis/build/microtears/Mood/android/build.gradle' line: 25

* What went wrong:
A problem occurred evaluating root project 'android'.
&gt; A problem occurred configuring project ':app'.
   &gt; Failed to install the following Android SDK packages as some licences have not been accepted.
   	build-tools;28.0.3 Android SDK Build-Tools 28.0.3
   	platforms;android-28 Android SDK Platform 28
   To build this project, accept the SDK license agreements and install the missing components using the Android Studio SDK Manager.
   Alternatively, to transfer the license agreements from one workstation to another, see http://d.android.com/r/studio-ui/export-licenses.html

   Using Android SDK: /usr/local/android-sdk

   * Try:
   Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

   * Get more help at https://help.gradle.org

BUILD FAILED in 42s
</code></pre>
<h2 id="错误原因-4">错误原因</h2>
<blockquote>
<p>some licences have not been accepted.</p>
</blockquote>
<h2 id="解决办法-4">解决办法</h2>
<p>.travis.yml before_installs部分添加：</p>
<pre><code class="language-yaml">- touch $HOME/.android/repositories.cfg
- yes | sdkmanager &quot;platforms;android-28&quot;
- yes | sdkmanager &quot;build-tools;28.0.3&quot;
</code></pre>
<p>修改完成后如下：</p>
<pre><code class="language-yaml">
···

before_install:
- touch $HOME/.android/repositories.cfg
- yes | sdkmanager &quot;platforms;android-28&quot;
- yes | sdkmanager &quot;build-tools;28.0.3&quot;

···

</code></pre>
<h2 id="q5">Q5</h2>
<h2 id="报错信息-5">报错信息</h2>
<pre><code class="language-shell">0.00s$ touch $HOME/.android/repositories.cfg
0.01s$ yes | sdkmanager &quot;platforms;android-28&quot;
/home/travis/.travis/functions: line 104: sdkmanager: command not found
The command &quot;yes | sdkmanager &quot;platforms;android-28&quot;&quot; failed and exited with 127 during .
</code></pre>
<h2 id="错误原因-5">错误原因</h2>
<p>没有导出相应的环境变量</p>
<h2 id="解决办法-5">解决办法</h2>
<p>.travis.yml添加：<code>dist: trusty</code>，注意不要出现语法错误</p>
<h2 id="q6">Q6</h2>
<h2 id="报错信息-6">报错信息</h2>
<p>Travis CI 发布到Github Release的包没有包含apk</p>
<h2 id="错误原因-6">错误原因</h2>
<p>apk文件被清理了</p>
<h2 id="解决办法-6">解决办法</h2>
<p>.travis.yml deploy部分添加（注意provider为releases）：</p>
<pre><code class="language-yaml">skip_cleanup: true
</code></pre>
<p>修改完成后如下：</p>
<pre><code class="language-yaml">
···

deploy:
provider: releases
api_key:
  secure: ...
file: build/app/outputs/apk/release/app-release.apk
skip_cleanup: true
on:
  tags: true
  repo: microtears/Mood

···

</code></pre>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://microtears.github.io/post/flutter-lu-you-tui-chu-dong-hua">
                  <h3 class="post-title">
                    Flutter路由退出动画
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
