<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=岁月总是历久弥新，需要细细品尝。 name=description><link href=/css/a11y-light.css rel=stylesheet><link href=/styles/main.css rel=stylesheet><link href=https://fonts.googleapis.com rel=preconnect><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel=stylesheet><title>Future</title><script src="https://www.googletagmanager.com/gtag/js?id=G-TQQBL084VX" async></script><script>window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());

          gtag("config", "G-TQQBL084VX");</script><body><main><div class=wrap><article><h1>Future</h1><p>A <code>_Future</code> has the following states:<ul><li><p>Incomplete: Maybe be completed, holds listeners.</p><li><p>Pending complete: Holds listeners</p> <ul><li>Incomplete and Pending both allow adding listeners to the object.</ul><li><p>Chained: Holds a future whose result will be this future's result.</p><li><p>Value: Is complete, holds value.</p><li><p>Error: Is complete, holds <code>AsyncError</code> The checks <code>_mayAddListener</code> (incomplete or pending complete), <code>_isChained</code> and <code>_isComplete</code> (value or error) exhausts all the states. These are represented by the following bits in the <code>_state</code> field along with a flag to allow unhandled errors. <code>_Future</code> states have the following transitions: When completing with a non-native <code>Future</code> or starting an async complete.</p><li><p>incomplete -> pending complete If a pending complete fails <em>synchronously</em> because of a mal-implemented <code>Future.then</code>.</p><li><p>pending complete -> incomplete. When completing with a native <code>_Future</code>.</p><li><p>incomplete -> chained</p> <ul><li>listeners in <code>_resultOrListeners</code> are moved to the chain source future.<li>chain source future is stored in <code>_resultOrListeners</code>. When completing synchronously with a value or error.</ul><li><p>incomplete -> completed (aka: value or error)</p> <ul><li>listeners in <code>_resultOrListeners</code> are extracted, and notified of the result. When a delayed async complete happens, or a non-native future completes with the needed value.</ul><li><p>pending complete -> completed</p> <ul><li>listeners in <code>_resultOrListeners</code> are extracted, and notified of the result. When a chained future recognizes that the future it's chained to has completed with an error or value. (May never happen, new listeners on the chained future are forwarded to the chain target future.)</ul><li><p>chained -> completed</p> <ul><li>The result (value or error) and state of the completed chain source future is copied into this future. Public operations checks that the current state is one that allows the requested operation. There is no transition between "pending complete" and "chained", because such a transition is never needed, and no transition out of "completed".</ul></ul></article><nav><a href=/ id=avatar-container> <img id=avatar src=https://avatars.githubusercontent.com/u/13548822 title=lingyin> </a><p>岁月总是历久弥新，需要细细品尝。<p>欢迎来到<a href=https://github.com/microtears> lingyin </a>的开发者日志, 这里是我的一些奇思妙想。<p>它使用 <a href=https://lume.land/> Lume </a>编写, 它是一个基于 <a href=https://deno.com/> Deno </a>的静态网站生成器。<div id=nav-break></div><p id=copyright>© 2019-2025 <a href=/>lingyin</a>.</nav></div><footer></footer></main>